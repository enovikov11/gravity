<!DOCTYPE html>
<html>

<head>
    <meta name="copyright" content="© 2025 Evgenii Novikov & co-authors">
    <style>
        body {
            overflow: hidden;
            margin: 0;
            padding: 0;
            height: 100vh;
            touch-action: none;
            user-select: none;
            -webkit-user-select: none;
            -webkit-touch-callout: none;
        }
    </style>
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no,maximum-scale=1">
    <meta charset="utf-8" />
</head>

<body>
    v4 <a href="versions.html" class="nospawn">Версии и changelog</a>
    <script>
        /*
            Идеи и фичреквесты:
            - Возможность задавать не только точки, но и их импульсы, как в Angry Birds
            - Дольше держишь - больше точка
            - Трейсеры с путями
            - Стрелочки с векторами скорости и ускорения
            - Play/pause import/export (based on url)
            - Time based with clock skew detection 
            - Sim speed
            - Fps and simulations/sec display
            - Total/visible count, invisible hide
            - Выбор формулы
        */

        let points = [];

        function updateSize() {
            this.radius = Math.sqrt(this.m) * 5;
            this.style.width = this.radius * 2 + "px";
            this.style.height = this.radius * 2 + "px";
            this.style.borderRadius = this.radius + "px";
        }

        function updatePos() {
            this.style.left = this.px - this.radius + "px";
            this.style.top = this.py - this.radius + "px";
        }

        function add(e) {
            if (Array.from(e.target.classList).includes("nospawn")) {
                return;
            }

            const div = document.createElement("div");

            div.style.backgroundColor = `hsl(${(251 * points.length % 360) | 0}deg 100% 50%)`;
            div.style.position = "absolute";

            div.m = Math.random() * 5 + 1;

            div.px = e.pageX;
            div.py = e.pageY;

            div.vx = 0;
            div.vy = 0;

            div.updateSize = updateSize;
            div.updatePos = updatePos;

            div.updateSize();
            div.updatePos();

            document.body.appendChild(div);
            points.push(div);
        }

        addEventListener("pointerup", add);

        const steps = 20, dt = 0.01, G = 5000, EPS = 10;

        function simulateStep() {
            for (let item of points) {
                item.ax = 0;
                item.ay = 0;
            }

            for (let i = 0; i < points.length; ++i) {
                const a = points[i];

                for (let j = i + 1; j < points.length; ++j) {
                    const b = points[j];

                    const dx = a.px - b.px, dy = a.py - b.py
                    const distSq = dx ** 2 + dy ** 2 + EPS;

                    // Формула гравитации не настоящая гравитация, делит на r, не на r^2
                    const Fx = G * dx / distSq;
                    const Fy = G * dy / distSq;

                    a.ax -= Fx / b.m;
                    a.ay -= Fy / b.m;

                    b.ax += Fx / a.m;
                    b.ay += Fy / a.m;
                }
            }

            for (let item of points) {
                item.vx += item.ax * dt;
                item.vy += item.ay * dt;

                item.px += item.vx * dt;
                item.py += item.vy * dt;

                item.updatePos();
            }
        }

        function render() {
            if (points.length > 1) {
                for (let i = 0; i < steps; i++) {
                    simulateStep();
                }
            }

            requestAnimationFrame(render);
        }

        render();
    </script>
</body>

</html>